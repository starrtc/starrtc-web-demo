var StarRtc=window.NameSpace||{};if(void 0===APP_PRODUCT_ID)var i=0,APP_PRODUCT_ID={R:i++,O:i++,t:i++,_:i++,s:i++,S:i++,i:i++,N:i++,I:i++,A:i++,o:i++};if(void 0===ACTION_GROUP_ID){i=0;var ACTION_GROUP_ID={V:i++,M:i++,C:i++,P:i++,T:i++,u:i++}}if(void 0===MSG_TYPE){i=0;var MSG_TYPE={L:i++,G:i++,l:i++,D:i++,p:i++}}if(void 0===MSG_DATA_TYPE){i=0;var MSG_DATA_TYPE={U:i++,v:i++,H:i++,k:i++}}if(void 0===ENCRYPT_TYPE){i=0;var ENCRYPT_TYPE={m:i++,g:i++}}if(void 0===AG_MSG_VOIP_CTRL)var AG_MSG_VOIP_CTRL={h:1e3,Y:1001,F:1002,W:1003,K:1004};if(void 0===AG_MSG){i=0;var AG_MSG={B:i++,J:i++,j:i++,X:i++,$:i++,q:i++,Z:i++,RR:i++,eR:i++,ER:i++,OR:i++,tR:i++,_R:i++,aR:i++,rR:i++,nR:i++,sR:i++,cR:i++,SR:i++,iR:i++,NR:i++,IR:i++,AR:i++,oR:i++,VR:i++,MR:i++,CR:i++,PR:i++,TR:i++,uR:i++,LR:i++,GR:i++,fR:i++,lR:i++,DR:i++,pR:i++}}if(void 0===CHAT_ROOM_TYPE){i=1;var CHAT_ROOM_TYPE={UR:i++,vR:i++}}if(void 0===AG_CHATROOMMOONSERVER){i=0;var AG_CHATROOMMOONSERVER={dR:i++,bR:i++,HR:i++,kR:i++,mR:i++,gR:i++,yR:i++,wR:i++,hR:i++,YR:i++,xR:i++,FR:i++,WR:i++,KR:i++,BR:i++,JR:i++,QR:i++,jR:i++,XR:i++,$R:i++,qR:i++,zR:i++,ZR:i++,Re:i++,ee:i++,Ee:i++,Oe:i++,te:i++,_e:i++,ae:i++,re:i++,ne:i++,se:i++,ce:i++,Se:i++,ie:i++,Ne:i++}}if(void 0===AG_VOIPMOONSERVER){i=0;var AG_VOIPMOONSERVER={Ie:i++,Ae:i++,oe:i++,Ve:i++,Me:i++,Ce:i++,Pe:i++,Te:i++,ue:i++,Le:i++,Ge:i++,fe:i++,le:i++,De:i++,pe:i++,Ue:i++,ve:i++,de:i++,be:i++,He:i++,ke:i++,me:i++,ge:i++,ye:i++,we:i++,he:i++,Ye:i++,xe:i++,Fe:i++,We:i++,Ke:i++,Be:i++,Je:i++,Qe:i++,je:i++,Xe:i++,$e:i++,qe:i++,ze:i++}}if(void 0===AG_LIVESRCMOONSERVER){i=0;var AG_LIVESRCMOONSERVER={Ze:i++,RE:i++,eE:i++,EE:i++,OE:i++,tE:i++,_E:i++,aE:i++,rE:i++,nE:i++,sE:i++,cE:i++,SE:i++,iE:i++,NE:i++,IE:i++,AE:i++,oE:i++,VE:i++,ME:i++,CE:i++,PE:i++,TE:i++,uE:i++,LE:i++,GE:i++,fE:i++,lE:i++,DE:i++,pE:i++,UE:i++,vE:i++,dE:i++,bE:i++,HE:i++,kE:i++,mE:i++,gE:i++,yE:i++,wE:i++,hE:i++,YE:i++,xE:i++,FE:i++,WE:i++,KE:i++,BE:i++,JE:i++,QE:i++,jE:i++,XE:i++,$E:i++,qE:i++,zE:i++,ZE:i++,RO:i++,eO:i++,EO:i++,OO:i++,tO:i++,_O:i++,aO:i++,rO:i++}}if(void 0===AG_LIVEVDNMOONSERVER){i=0;var AG_LIVEVDNMOONSERVER={nO:i++,sO:i++,cO:i++,SO:i++,iO:i++,NO:i++,IO:i++,AO:i++,oO:i++,VO:i++,MO:i++,CO:i++,PO:i++,TO:i++,uO:i++,LO:i++,GO:i++,fO:i++,lO:i++,DO:i++,pO:i++,UO:i++,vO:i++}}function clone(R){if(null==R||"object"!=typeof R)return R;if(R instanceof Date)return(e=new Date).setTime(R.getTime()),e;if(R instanceof Array){for(var e=[],E=R.length,O=0;O<E;++O)e[O]=clone(R[O]);return e}if(R instanceof Object){e={};for(var t in R)R.hasOwnProperty(t)&&(e[t]=clone(R[t]));return e}throw new Error("Unable to copy obj! Its type isn't supported.")}StarRtc.AUtils=new function(){var N,I=this,l="",U="",v="",d="";function C(R,e){for(var E=H(R),O=k(D(E.length.toString(16))),t=H(e),_=k(D(t.length.toString(16))),a=new Uint8Array(E.length+t.length+8),r=0,n=O.length,s=r;s<n;s++)a[s]=O[s-r];n=(r=n)+E.length;for(s=r;s<n;s++)a[s]=E[s-r];n=(r=n)+_.length;for(s=r;s<n;s++)a[s]=_[s-r];n=(r=n)+t.length;for(s=r;s<n;s++)a[s]=t[s-r];return a}function A(R){var e=new Uint8Array(R),E=0,O=parseInt("0x"+M(e.slice(E,E+4)));E+=4;var t=V(e.slice(E,E+O));E+=O;var _=parseInt("0x"+M(e.slice(E,E+4)));return E+=4,{digest:t,content:V(e.slice(E,E+_))}}function D(R){var e=8-R.length;return"00000000".substr(0,e)+R}function b(R){var e=4-R.length;return"0000".substr(0,e)+R}function o(R,e){var E=new Array(R+1).join("0"),O=R-e.length;return E.substr(0,O)+e}function H(R){var e,E,O=new Array;e=R.length;for(var t=0;t<e;t++)65536<=(E=R.charCodeAt(t))&&E<=1114111?(O.push(E>>18&7|240),O.push(E>>12&63|128),O.push(E>>6&63|128),O.push(63&E|128)):2048<=E&&E<=65535?(O.push(E>>12&15|224),O.push(E>>6&63|128),O.push(63&E|128)):128<=E&&E<=2047?(O.push(E>>6&31|192),O.push(63&E|128)):O.push(255&E);return O}function V(R){if("string"==typeof R)return R;for(var e="",E=R,O=0;O<E.length;O++){var t=E[O].toString(2),_=t.match(/^1+?(?=0)/);if(_&&8==t.length){for(var a=_[0].length,r=E[O].toString(2).slice(7-a),n=1;n<a;n++)r+=E[n+O].toString(2).slice(2);e+=String.fromCharCode(parseInt(r,2)),O+=a-1}else e+=String.fromCharCode(E[O])}return e}function k(R){var e=0,E=R.length;if(E%2!=0)return null;E/=2;for(var O=new Array,t=0;t<E;t++){var _=R.substr(e,2),a=parseInt("0x"+_);O.push(a),e+=2}return O}function M(R){for(var e="",E=0;E<R.length;E++){var O=R[E].toString(16);1==O.length&&(O="0"+O),e+=O}return e}function m(R,e,E){var O=e;for(var t in E)for(var _=E[t],a=0;a<_.length;a++,O++)R[O]=_[a]}I.msgMaxLen=0,I.setUserInfo=function(R,e,E){v=(l=R)+"_"+(U=e),d=E},I.clear=function(){d=v=U=l="",I.msgMaxLen=0,clearInterval(N)},I.parseProtocol=function(R,c){var e=new Blob([R],{type:"text/plain"}),S=new FileReader;S.readAsArrayBuffer(e),S.onload=function(R){var e=new Uint8Array(S.result);console.info("parseProtocol:",e);var E=e[0],O=e.slice(1,5),t=e[5],_=e.slice(6,8),a=e.slice(8,10),r=e[10],n=e.slice(11,e.byteLength-2);console.info("parseProtocol: msgArr = ",n);var s=e.slice(e.byteLength-2,e.byteLength);c({appid:E,plength:O,appver:t,rese1:_,rese2:a,actionid:r,msgArr:n,end:s})}},I.packageProtocol=function(R,e,E){var O=R,t=new Array(255,255),_=new Array(255,255),a=e,r=(new Array(18,52),E),n=new Uint8Array(r),s=k(D((r.byteLength+12).toString(16))),c=new ArrayBuffer(r.byteLength+13),S=new Uint8Array(c);S[0]=O;for(var i=1;i<5;i++)S[i]=s[i-1];S[5]=1,S[6]=t[0],S[7]=t[1],S[8]=_[0],S[9]=_[1],S[10]=a;for(i=11;i<11+n.byteLength;i++)S[i]=n[i-11];return S[11+n.byteLength]=18,S[12+n.byteLength]=52,console.log("packageProtocol",S),S},I.constructAuthMsg=function(){for(var R=k(b(AG_MSG.B.toString(16))),e=H(v),E=k(b(e.length.toString(16))),O=H(d),t=new Uint8Array(e.length+36),_=0,a=R.length,r=_;r<a;r++)t[r]=R[r];a=(_=a)+E.length;for(r=_;r<a;r++)t[r]=E[r-_];a=(_=a)+e.length;for(r=_;r<a;r++)t[r]=e[r-_];a=(_=a)+O.length;for(r=_;r<a;r++)t[r]=O[r-_];_=0;var n=[];return n.push(R),n.push(E),n.push(e),n.push(O),m(t,_,n),t},I.constructSingleMsg=function(R,e,E,O,t){var _=k(b(AG_MSG.q.toString(16))),a=H(v),r=k(b(a.length.toString(16))),n=H(l+"_"+R),s=k(b(n.length.toString(16))),c=k(D(e.toString(16))),S=ENCRYPT_TYPE.m,i=MSG_DATA_TYPE.v;null!=t&&(i=t);var N={fromId:U,targetId:R,time:"0",msgIndex:e,type:"1",code:"0",contentData:O},I=C(E,JSON.stringify(N)),A=k(D(I.length.toString(16))),o=new Uint8Array(a.length+n.length+I.length+16),V=[];return V.push(_),V.push(r),V.push(a),V.push(s),V.push(n),V.push(c),V.push([S]),V.push([i]),V.push(A),V.push(I),m(o,0,V),o},I.constructGroupMsg=function(R,e,E,O){var t=k(b(AG_MSG.rR.toString(16))),_=H(""),a=k(b(_.length.toString(16))),r=k(D(e.toString(16))),n=H(l+"_"+R),s=k(b(n.length.toString(16))),c=H(v),S=k(b(c.length.toString(16))),i=ENCRYPT_TYPE.m,N=MSG_DATA_TYPE.v,I={fromId:U,targetId:R,time:"0",msgIndex:e,type:"1",code:"0",contentData:O},A=C(E,JSON.stringify(I)),o=k(D(A.length.toString(16))),V=new Uint8Array(_.length+n.length+c.length+A.length+18),M=[];return M.push(t),M.push(a),M.push(_),M.push(r),M.push(s),M.push(n),M.push(S),M.push(c),M.push([i]),M.push([N]),M.push(o),M.push(A),m(V,0,M),V},I.constructReceivedMsg=function(R){var e=k(b(AG_MSG.CR.toString(16))),E=H(v),O=k(b(E.length.toString(16))),t=new Uint8Array(R),_=new Uint8Array(E.length+12),a=[];return a.push(e),a.push(O),a.push(E),a.push(t),m(_,0,a),_},I.constructSingleCtrlMsg=function(R,e,E,O,t){var _=k(b(AG_MSG.q.toString(16))),a=H(v),r=k(b(a.length.toString(16))),n=H(l+"_"+R),s=k(b(n.length.toString(16))),c=k(D(e.toString(16))),S=ENCRYPT_TYPE.m,i=MSG_DATA_TYPE.U,N={fromId:U,targetId:R,time:"0",msgIndex:e,type:"0",code:t,contentData:O},I=C(E,JSON.stringify(N)),A=k(D(I.length.toString(16))),o=new Uint8Array(a.length+n.length+I.length+16),V=[];return V.push(_),V.push(r),V.push(a),V.push(s),V.push(n),V.push(c),V.push([S]),V.push([i]),V.push(A),V.push(I),m(o,0,V),o},I.constructVOIPProtocol=function(R,e){var E,O=[],t=k(b(R.toString(16))),_=H(v),a=k(b(_.length.toString(16))),r=H(d),n=k(b(r.length.toString(16)));switch(R){case AG_VOIPMOONSERVER.Ve:case AG_VOIPMOONSERVER.Ce:var s=H(l+"_"+e.targetId),c=k(b(s.length.toString(16))),S=k(o(8,parseInt(e.audioSSRC).toString(16))),i=k(o(8,parseInt(e.videoSSRC).toString(16))),N=k(o(2,parseInt(e.videoCodec).toString(16))),I=k(o(2,parseInt(e.audioCodec).toString(16)));E=new Uint8Array(2+(2+_.length)+(2+r.length)+(2+s.length)+4+4+1+1),O.push(t),O.push(a),O.push(_),O.push(n),O.push(r),O.push(c),O.push(s),O.push(S),O.push(i),O.push(N),O.push(I);break;case AG_VOIPMOONSERVER.ue:var A=e.isActive;E=new Uint8Array(3),O.push(t),O.push([A])}return m(E,0,O),E},I.constructSrcProtocol=function(R,e){var E,O=[],t=k(b(R.toString(16))),_=k(b((I=H(v)).length.toString(16))),a=k(b((A=H(d)).length.toString(16)));switch(R){case AG_LIVESRCMOONSERVER.oE:case AG_LIVESRCMOONSERVER.VE:var r=k(b(e.conCurrentNum.toString(16))),n=k(b((0).toString(16))),s=k(b((i=H(e.roomId)).length.toString(16))),c=e.liveType,S=k(b((M=H(e.extra)).length.toString(16)));E=new Uint8Array(2+(2+I.length)+(2+A.length)+2+2+(2+i.length)+1+(2+M.length)),O.push(t),O.push(_),O.push(I),O.push(a),O.push(A),O.push(r),O.push(n),O.push(s),O.push(i),O.push([c]),O.push(S),O.push(M);break;case AG_LIVESRCMOONSERVER.ME:r=k(b(e.conCurrentNum.toString(16))),n=k(b(e.validTime.toString(16))),s=k(b((i=H(e.roomId)).length.toString(16))),S=k(b((M=H(e.extra)).length.toString(16)));var i,N=k(b((C=H(e.spec)).length.toString(16)));O.push(t),O.push(_),O.push(I),O.push(a),O.push(A),O.push(r),O.push(n),O.push(s),O.push(i),O.push(S),O.push(M),O.push(N),O.push(C);break;case AG_LIVESRCMOONSERVER.CE:t=k(b(R.toString(16))),_=k(b((I=H(U)).length.toString(16))),a=k(b((A=H(d)).length.toString(16))),n=k(b((0).toString(16)));var I,A,o=k(b((V=H(e.groupId)).length.toString(16)));S=k(b((M=H(e.extra)).length.toString(16)));O.push(t),O.push(_),O.push(I),O.push(a),O.push(A),O.push(n),O.push(o),O.push(V),O.push(S),O.push(M);break;case AG_LIVESRCMOONSERVER.PE:var V,M,C;n=k(b((0).toString(16))),o=k(b((V=H(e.groupId)).length.toString(16))),S=k(b((M=H(e.extra)).length.toString(16))),N=k(b((C=H(e.spec)).length.toString(16)));O.push(t),O.push(_),O.push(I),O.push(a),O.push(A),O.push(n),O.push(o),O.push(V),O.push(S),O.push(M),O.push(N),O.push(C);break;case AG_LIVESRCMOONSERVER.TE:var P=H(e.channelId),T=H(e.avParam),u=k(b(T.length.toString(16)));O.push(t),O.push(_),O.push(I),O.push(a),O.push(A),O.push(P),O.push(u),O.push(T);break;case AG_LIVESRCMOONSERVER.LE:P=H(e.channelId);var L=k(b((G=H(e.upUserId)).length.toString(16)));O.push(t),O.push(_),O.push(I),O.push(a),O.push(A),O.push(P),O.push(L),O.push(G);break;case AG_LIVESRCMOONSERVER.GE:case AG_LIVESRCMOONSERVER.fE:case AG_LIVESRCMOONSERVER.lE:var G;P=H(e.channelId),L=k(b((G=H(e.upUserId)).length.toString(16)));O.push(t),O.push(_),O.push(I),O.push(a),O.push(A),O.push(P),O.push(L),O.push(G);break;case AG_LIVESRCMOONSERVER.DE:case AG_LIVESRCMOONSERVER.pE:P=H(e.channelId);E=new Uint8Array(2+(2+I.length)+(2+A.length)+16),O.push(t),O.push(_),O.push(I),O.push(a),O.push(A),O.push(P);break;case AG_LIVESRCMOONSERVER.UE:for(var f=e.streamConfig,l=new Uint8Array(16),D=0;D<16;D++)null!=f[D]?l[D]=f[D]:l[D]=0;E=new Uint8Array(18),O.push(t),O.push(l);break;case AG_LIVESRCMOONSERVER.vE:P=H(e.channelId);O.push(t),O.push(P);break;case AG_LIVESRCMOONSERVER.bE:O.push(t);break;case AG_LIVESRCMOONSERVER.dE:var p=H(e.streamData);E=new Uint8Array(3+p.length),O.push(t),O.push([e.streamDataType]),O.push(p)}return m(E,0,O),E},I.constructVdnProtocol=function(R,e){var E,O=[],t=k(b(R.toString(16))),_=H(v),a=k(b(_.length.toString(16))),r=H(d),n=k(b(r.length.toString(16)));switch(R){case AG_LIVEVDNMOONSERVER.cO:var s=k(o(8,parseInt(e.ssrc).toString(16))),c=k(o(2,parseInt(e.videoCodec).toString(16))),S=k(o(2,parseInt(e.audioCodec).toString(16)));E=new Uint8Array(8),O.push(t),O.push(s),O.push(c),O.push(S);break;case AG_LIVEVDNMOONSERVER.SO:var i=H(e.channelId);E=new Uint8Array(18+(2+_.length)+(2+r.length)),O.push(t),O.push(i),O.push(a),O.push(_),O.push(n),O.push(r);break;case AG_LIVEVDNMOONSERVER.iO:case AG_LIVEVDNMOONSERVER.NO:E=new Uint8Array(2),O.push(t);break;case AG_LIVEVDNMOONSERVER.oO:case AG_LIVEVDNMOONSERVER.IO:i=H(e.channelId);E=new Uint8Array(18),O.push(t),O.push(i);break;case AG_LIVEVDNMOONSERVER.AO:for(var N=e.streamConfig,I=new Uint8Array(16),A=0;A<16;A++)null!=N[A]?I[A]=N[A]:I[A]=0;E=new Uint8Array(18),O.push(t),O.push(I)}return m(E,0,O),E},I.constructChatProtocol=function(R,e){var E,O=[],t=k(b(R.toString(16))),_=H(v),a=k(b(_.length.toString(16))),r=H(d),n=k(b(r.length.toString(16)));if(R==AG_CHATROOMMOONSERVER.dR){var s=e.roomType,c=k(b(e.conCurrentNum.toString(16))),S=H(e.userDefineData),i=k(D(S.length.toString(16)));E=new Uint8Array(2+(2+_.length)+(2+r.length)+1+2+(4+S.length)),O.push(t),O.push(a),O.push(_),O.push(n),O.push(r),O.push([s]),O.push(c),O.push(i),O.push(S)}else if(R==AG_CHATROOMMOONSERVER.bR)E=new Uint8Array(2),O.push(t);else if(R==AG_CHATROOMMOONSERVER.HR){var N=H(l+"_"+e.banUserId),I=k(b(N.length.toString(16))),A=k(b(e.banTime.toString(16)));E=new Uint8Array(2+(2+N.length)+2),O.push(t),O.push(I),O.push(N),O.push(A)}else if(R==AG_CHATROOMMOONSERVER.kR){var o=H(l+"_"+e.kickOutUserId),V=k(b(o.length.toString(16)));E=new Uint8Array(2+(2+o.length)),O.push(t),O.push(V),O.push(o)}else if(R==AG_CHATROOMMOONSERVER.mR)E=new Uint8Array(2),O.push(t);else if(R==AG_CHATROOMMOONSERVER.gR){var M=H(e.roomId);E=new Uint8Array(2+(2+_.length)+(2+r.length)+16),O.push(t),O.push(a),O.push(_),O.push(n),O.push(r),O.push(M)}else if(R==AG_CHATROOMMOONSERVER.yR);else if(R==AG_CHATROOMMOONSERVER.wR)E=new Uint8Array(2),O.push(t);else if(R==AG_CHATROOMMOONSERVER.hR){var C={fromId:U,targetId:e.roomId,time:"0",msgIndex:e.msgIndex,type:"1",code:"0",contentData:e.msg},P=H(JSON.stringify(C)),T=k(D(P.length.toString(16)));E=new Uint8Array(2+(4+P.length)),O.push(t),O.push(T),O.push(P)}else if(R==AG_CHATROOMMOONSERVER.YR){C={fromId:U,targetId:e.roomId,time:"0",msgIndex:e.msgIndex,type:e.type,code:e.code,contentData:e.msg};var u=H(JSON.stringify(C)),L=k(D(u.length.toString(16))),G=H(l+"_"+e.toUserId),f=k(b(G.length.toString(16)));E=new Uint8Array(2+(2+G.length)+(4+u.length)),O.push(t),O.push(f),O.push(G),O.push(L),O.push(u)}else if(R==AG_CHATROOMMOONSERVER.xR){M=H(e.roomId);E=new Uint8Array(18),O.push(t),O.push(M)}return m(E,0,O),E},I.constructWebrtcUploadMsgProtocol=function(R){var e=k(b(AG_LIVESRCMOONSERVER.uE.toString(16))),E=H(v),O=k(b(E.length.toString(16))),t=H(d),_=k(b(t.length.toString(16))),a=H(R.channelId),r=k(o(8,parseInt(R.audioSSRC).toString(16))),n=k(o(8,parseInt(R.smallVideoSSRC).toString(16))),s=k(o(8,parseInt(R.bigVideoSSRC).toString(16))),c=k(o(2,parseInt(R.videoCodec).toString(16))),S=k(o(2,parseInt(R.audioCodec).toString(16))),i=new Uint8Array(E.length+t.length+34+1+1);return m(i,0,[e,O,E,_,t,a,r,n,s,c,S]),i},I.parseMessage=function(R){var e,E=new Uint8Array(R);switch(parseInt("0x"+M(E.slice(0,2)))){case AG_MSG.J:E=new Uint8Array(R);StarRtc.AUtils.msgMaxLen=parseInt("0x"+M(E.slice(2,4))),console.log("登录成功，最大消息长度：",StarRtc.AUtils.msgMaxLen),StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.V,I.constructHeartBeatMsg(AG_MSG.X))),N=setInterval(function(){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.V,I.constructHeartBeatMsg(AG_MSG.X)))},15e3);break;case AG_MSG.j:console.log("登录失败");break;case AG_MSG.$:console.log("心跳反馈");break;case AG_MSG.VR:console.log("服务器收到消息");break;case AG_MSG.MR:console.log("收到消息");parseInt("0x"+M(E.slice(10,14)));var O=15;switch(E[14]){case MSG_TYPE.L:console.log("单聊消息");var t=parseInt("0x"+M(E.slice(O,O+2)));O+=2;var _=V(E.slice(O,O+t)),a=E[O+=t];switch(O+=1,a){case ENCRYPT_TYPE.m:var r=parseInt("0x"+M(E.slice(O,O+4)));O+=4;var n=A(E.slice(O,O+r));console.log(_,n.digest,n.content),StarRtc.StarManager.getSingleMessage(_,n.digest,n.content);break;case ENCRYPT_TYPE.g:}break;case MSG_TYPE.G:console.log("群消息");var s=parseInt("0x"+M(E.slice(O,O+2)));O+=2;var c=V(E.slice(O,O+s));O+=s;t=parseInt("0x"+M(E.slice(O,O+2)));O+=2;_=V(E.slice(O,O+t)),a=E[O+=t];switch(O+=1,a){case ENCRYPT_TYPE.m:r=parseInt("0x"+M(E.slice(O,O+4)));O+=4;n=A(E.slice(O,O+r));console.log(c,_,n.digest,n.content),StarRtc.StarManager.getGroupMessage(c,_,n.digest,n.content);break;case ENCRYPT_TYPE.g:}break;case MSG_TYPE.l:console.log("群私信消息");s=parseInt("0x"+M(E.slice(O,O+2)));O+=2;c=V(E.slice(O,O+s));O+=s;t=parseInt("0x"+M(E.slice(O,O+2)));O+=2;_=V(E.slice(O,O+t)),a=E[O+=t];switch(O+=1,a){case ENCRYPT_TYPE.m:r=parseInt("0x"+M(E.slice(O,O+4)));O+=4;n=A(E.slice(O,O+r));console.log(c,_,n.digest,n.content),StarRtc.StarManager.getGroupPrivateMessage(c,_,n.digest,n.content);break;case ENCRYPT_TYPE.g:}break;case MSG_TYPE.D:console.log("推送群信息");s=parseInt("0x"+M(E.slice(O,O+2)));O+=2;c=V(E.slice(O,O+s));O+=s;r=parseInt("0x"+M(E.slice(O,O+4)));O+=4;n=A(E.slice(O,O+r));console.log(c,n.digest,n.content),StarRtc.StarManager.getGroupPushMessage(c,n.digest,n.content);break;case MSG_TYPE.p:console.log("推送系统信息");r=parseInt("0x"+M(E.slice(O,O+4)));O+=4;n=A(E.slice(O,O+r));console.log(n.digest,n.content),StarRtc.StarManager.getSystemPushMessage(n.digest,n.content)}e=E.slice(2,10),console.log("发送消息回执"),StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.V,StarRtc.AUtils.constructReceivedMsg(e)));break;case AG_MSG.PR:var S=parseInt("0x"+M(E.slice(2,4))),i=V(E.slice(6,E.byteLength));console.log("报错:",S,i),StarRtc.StarManager.getErrorMessage(S,i)}},I.parseSrcMoonServerMessage=function(R,e){var E=new Uint8Array(R);switch(parseInt("0x"+M(E.slice(0,2)))){case AG_LIVESRCMOONSERVER.gE:M(E.slice(18,20));var O=parseInt("0x"+M(E.slice(18,20)));e({type:"srcApplyUpload",status:"success",fingerprint:V(E.slice(20,20+O))});break;case AG_LIVESRCMOONSERVER.yE:var t=parseInt("0x"+M(E.slice(2,4)));e({type:"srcApplyUpload",status:"failed",msg:i=V(E.slice(4,4+t))});break;case AG_LIVESRCMOONSERVER.OO:console.log("webrtc心跳反馈");break;case AG_LIVESRCMOONSERVER.tO:for(var _=parseInt("0x"+M(E.slice(2,3))),a=3,r=E.length,n={siv:_,uperInfos:{}};a<r;){var s=parseInt("0x"+M(E.slice(a,a+1)));a+=1;var c=parseInt("0x"+M(E.slice(a,a+2)));a+=2;var S=V(E.slice(a,a+c));a+=c,n.uperInfos[s]={upId:s,userId:S}}e({type:"uperStreamInfoUpdate",status:"success",msg:n});break;case AG_LIVESRCMOONSERVER.EO:e({type:"stopStream",status:"success"});break;case AG_LIVESRCMOONSERVER.qE:e({type:"streamConfig",status:"success",channelId:V(E.slice(2,18))});break;case AG_LIVESRCMOONSERVER.zE:e({type:"streamConfig",status:"failed",channelId:V(E.slice(2,18))});break;case AG_LIVESRCMOONSERVER.XE:e({type:"delChannel",status:"success",channelId:V(E.slice(2,18))});break;case AG_LIVESRCMOONSERVER.$E:t=parseInt("0x"+M(E.slice(2,4)));var i=V(E.slice(4,4+t));e({type:"delChannel",status:"failed",channelId:V(E.slice(4+t,4+t+16)),msg:i});break;case AG_LIVESRCMOONSERVER.HE:e({type:"createChannel",status:"success",channelId:V(E.slice(2,18))});break;case AG_LIVESRCMOONSERVER.kE:t=parseInt("0x"+M(E.slice(2,4)));e({type:"createChannel",status:"failed",msg:i=V(E.slice(4,4+t))});break;case AG_LIVESRCMOONSERVER._O:s=parseInt("0x"+M(E.slice(2,3))),_=parseInt("0x"+M(E.slice(3,4)));var N=V(E.slice(5));e({type:"streamData",status:"success",upId:s,siv:_,streamDataType:parseInt("0x"+M(E.slice(4,5))),streamData:N});break;case AG_LIVESRCMOONSERVER.aO:(i={}).errId=parseInt("0x"+M(E.slice(2,4))),i.errStrlen=parseInt("0x"+M(E.slice(4,6))),i.errStr=V(E.slice(6,6+i.errStrlen)),e({type:"serverErr",status:"failed",msg:i})}},I.parseVdnMoonServerMessage=function(R,e){var E=new Uint8Array(R);switch(parseInt("0x"+M(E.slice(0,2)))){case AG_LIVEVDNMOONSERVER.VO:var O=parseInt("0x"+M(E.slice(2,4)));e({type:"vdnWebrtcReg",status:"success",fingerprint:V(E.slice(4,4+O))});break;case AG_LIVEVDNMOONSERVER.MO:for(var t=V(E.slice(2,18)),_=parseInt("0x"+M(E.slice(18,19))),a=19,r=E.length,n={siv:_,uperInfos:{}};a<r;){var s=parseInt("0x"+M(E.slice(a,a+1)));a+=1;var c=parseInt("0x"+M(E.slice(a,a+2)));a+=2;var S=V(E.slice(a,a+c));a+=c,n.uperInfos[s]={upId:s,userId:S}}e({type:"vdnApplyDownload",status:"success",channelId:t,uperInfos:n});break;case AG_LIVEVDNMOONSERVER.CO:console.log("vdn 心跳反馈");break;case AG_LIVEVDNMOONSERVER.PO:var i=parseInt("0x"+M(E.slice(2,4))),N=V(E.slice(4,4+i));e({type:"vdnApplyDownload",status:"failed",channelId:t=V(E.slice(4+i,4+i+16)),failedStatus:N});break;case AG_LIVEVDNMOONSERVER.TO:e({type:"streamConfig",status:"success",channelId:t=V(E.slice(2,18))});break;case AG_LIVEVDNMOONSERVER.uO:e({type:"streamConfig",status:"failed",channelId:t=V(E.slice(2,18))});break;case AG_LIVEVDNMOONSERVER.LO:for(t=V(E.slice(2,18)),_=parseInt("0x"+M(E.slice(18,19))),a=19,r=E.length,n={channelId:t,siv:_,uperInfos:{}};a<r;){s=parseInt("0x"+M(E.slice(a,a+1)));a+=1;c=parseInt("0x"+M(E.slice(a,a+2)));a+=2;S=V(E.slice(a,a+c));a+=c,n.uperInfos[s]={upId:s,userId:S}}e({type:"uperStreamInfoUpdate",status:"success",channelId:t,msg:n});break;case AG_LIVEVDNMOONSERVER.GO:e({type:"streamData",status:"success",upId:s=parseInt("0x"+M(E.slice(2,3))),siv:_=parseInt("0x"+M(E.slice(3,4))),streamDataType:parseInt("0x"+M(E.slice(4,5))),streamData:V(E.slice(5))});break;case AG_LIVEVDNMOONSERVER.fO:case AG_LIVEVDNMOONSERVER.lO:case AG_LIVEVDNMOONSERVER.DO:break;case AG_LIVEVDNMOONSERVER.UO:var I={};I.errId=parseInt("0x"+M(E.slice(2,4))),I.errStrlen=parseInt("0x"+M(E.slice(4,6))),I.errStr=V(E.slice(6,6+I.errStrlen)),e({type:"serverErr",status:"failed",msg:I})}},I.parseChatMoonServerMessage=function(R,e){var E=new Uint8Array(R),O=parseInt("0x"+M(E.slice(0,2)));switch(O){case AG_CHATROOMMOONSERVER.FR:e({type:"createChatRoom",status:"success",chatroomId:_=V(E.slice(2,18)),maxContentLen:parseInt("0x"+M(E.slice(18,20)))});break;case AG_CHATROOMMOONSERVER.WR:var t=parseInt("0x"+M(E.slice(2,4)));e({type:"createChatRoom",status:"failed",status:V(E.slice(4,4+t))});break;case AG_CHATROOMMOONSERVER.KR:e({type:"deleteChatRoom",status:"success",roomId:_=V(E.slice(2,18))});break;case AG_CHATROOMMOONSERVER.BR:var _=V(E.slice(2,18));t=parseInt("0x"+M(E.slice(18,20)));e({type:"deleteChatRoom",status:"failed",msg:V(E.slice(20,20+t)),roomId:_});break;case AG_CHATROOMMOONSERVER.JR:var a=parseInt("0x"+M(E.slice(2,4)));e({type:"banaedToSendMsg",status:"success",banUserId:r=V(E.slice(4,4+a)),banTime:n=parseInt("0x"+M(E.slice(4+a,4+a+2)))});break;case AG_CHATROOMMOONSERVER.QR:a=parseInt("0x"+M(E.slice(2,4)));var r=V(E.slice(4,4+a)),n=parseInt("0x"+M(E.slice(4+a,4+a+2)));t=parseInt("0x"+M(E.slice(4+a+2,4+a+2+2)));e({type:"banaedToSendMsg",status:"failed",banUserId:r,banTime:n,msg:V(E.slice(4+a+2+2,4+a+2+2+t))});break;case AG_CHATROOMMOONSERVER.jR:var s=parseInt("0x"+M(E.slice(2,4)));e({type:"kickOutUser",status:"success",kickOutUserId:c=V(E.slice(4,4+s))});break;case AG_CHATROOMMOONSERVER.XR:s=parseInt("0x"+M(E.slice(2,4)));var c=V(E.slice(4,4+s));t=parseInt("0x"+M(E.slice(4+s,4+a+2)));e({type:"kickOutUser",status:"failed",kickOutUserId:c,msg:V(E.slice(4+s+2,4+s+2+t))});break;case AG_CHATROOMMOONSERVER.$R:case AG_CHATROOMMOONSERVER.qR:e({type:"joinChatRoom",status:"success",roomId:_=V(E.slice(2,18)),maxContentLen:parseInt("0x"+M(E.slice(18,20)))});break;case AG_CHATROOMMOONSERVER.zR:_=V(E.slice(2,18)),t=parseInt("0x"+M(E.slice(18,20)));e({type:"joinChatRoom",status:"failed",failedStatus:V(E.slice(20,20+t)),roomId:_});break;case AG_CHATROOMMOONSERVER.ZR:console.log("chatRoom心跳反馈");break;case AG_CHATROOMMOONSERVER.Re:case AG_CHATROOMMOONSERVER.ee:var S=parseInt("0x"+M(E.slice(2,4))),i=V(E.slice(4,4+S)),N=parseInt("0x"+M(E.slice(4+S,4+S+4))),I=V(E.slice(4+S+4,4+S+4+N));e({type:O==AG_CHATROOMMOONSERVER.Re?"recvChatPrivateMsg":"recvChatMsg",status:"success",fromUserId:i,msg:I});break;case AG_CHATROOMMOONSERVER.Ee:e({type:"chatroomUserBannedMsg",status:"success",banTime:n=parseInt("0x"+M(E.slice(2,4)))});break;case AG_CHATROOMMOONSERVER.Oe:e({type:"chatroomUserKicked",status:"success"});break;case AG_CHATROOMMOONSERVER.te:e({type:"sendMsgNoFree"});break;case AG_CHATROOMMOONSERVER._e:(I={}).errId=parseInt("0x"+M(E.slice(2,4))),I.errStrlen=parseInt("0x"+M(E.slice(4,6))),I.errStr=V(E.slice(6,6+I.errStrlen)),e({type:"serverErr",status:"failed",msg:I});break;case AG_CHATROOMMOONSERVER.ae:e({type:"getRoomOnlineNum",status:"success",roomId:_=V(E.slice(2,18)),onlineNum:parseInt("0x"+M(E.slice(18,22)))})}},I.parseVoipMoonServerMessage=function(R,e){var E=new Uint8Array(R);switch(parseInt("0x"+M(E.slice(0,2)))){case AG_VOIPMOONSERVER.Le:e({type:"voipCallingAck",status:"success"});break;case AG_VOIPMOONSERVER.fe:var O=parseInt("0x"+M(E.slice(2,4)));e({type:"voipCalling",status:"success",fingerprint:V(E.slice(4,4+O))});break;case AG_VOIPMOONSERVER.le:(t={}).errId=parseInt("0x"+M(E.slice(2,4))),t.errStrlen=parseInt("0x"+M(E.slice(4,6))),t.errStr=V(E.slice(6,6+t.errStrlen)),e({type:"voipCalling",status:"failed",msg:t});break;case AG_VOIPMOONSERVER.pe:O=parseInt("0x"+M(E.slice(2,4)));e({type:"voipResponseing",status:"success",fingerprint:V(E.slice(4,4+O))});break;case AG_VOIPMOONSERVER.Ue:(t={}).errId=parseInt("0x"+M(E.slice(2,4))),t.errStrlen=parseInt("0x"+M(E.slice(4,6))),t.errStr=V(E.slice(6,6+t.errStrlen)),e({type:"voipResponseing",status:"failed",msg:t});break;case AG_VOIPMOONSERVER.ve:case AG_VOIPMOONSERVER.de:break;case AG_VOIPMOONSERVER.be:var t;(t={}).errId=parseInt("0x"+M(E.slice(2,4))),t.errStrlen=parseInt("0x"+M(E.slice(4,6))),t.errStr=V(E.slice(6,6+t.errStrlen)),e({type:"serverErr",status:"failed",msg:t})}},I.constructHeartBeatMsg=function(R){return new Uint8Array(k(b(R.toString(16))))}},StarRtc.StarManager=new function(){var t=this,R="starRTC v1.0.0",_="",a="",r="",n="",s="",e=null,c=null,S="";t.version=function(){return console.log(R),R},t.login=function(R,e,E,O){"WebSocket"in window?(r=(_=R)+"_"+(a=e),n=E,c=O,StarRtc.Instance.configModePulic?$.get("https://"+StarRtc.Instance.loginServerUrl+":"+StarRtc.Instance.loginServerPort+"/?userId="+r+"&authKey="+n,function(R,e){if(console.log("authKey 验证：",e,R),"success"===e){var E=JSON.parse(R);1==E.status?(s=E.data,$.get("https://"+StarRtc.Instance.msgScheduleUrl+":"+StarRtc.Instance.msgSchedulePort+"/?userId="+r,function(R,e){e="success";console.log("消息调度：",e,R);var E=JSON.parse(R);1==E.status?(S="wss://"+E.data,t.connect()):O({msg:"请求msg调度数据异常"},"connect failed")})):O({msg:"登录验证失败"},"connect failed")}else O({msg:"请求验证地址失败"},"connect failed")}):(S="wss://"+StarRtc.Instance.msgServerUrl+":"+StarRtc.Instance.msgServerWebsocketPort,t.connect())):(console.log("当前浏览器 Not support websocket"),O({msg:"当前浏览器 Not support websocket"},"connect failed"))},t.connect=function(){console.log("WebSocket："+S),(e=new WebSocket(S)).onerror=function(){console.log("WebSocket连接发生错误"),c({msg:"WebSocket连接发生错误"},"connect failed")},e.onopen=function(){console.log("WebSocket连接成功"),c({msg:"WebSocket连接成功"},"connect success"),t.startAuth()},e.onmessage=function(R){console.log("onmessage",R.data),c(R.data,"onmessage")},e.onclose=function(){console.log("WebSocket连接关闭"),c({msg:"WebSocket连接关闭"},"connect closed"),e=null}},t.close=function(){console.log("关闭WebSocket连接"),StarRtc.AUtils.clear(),null!=e&&e.close()},t.send=function(R){null!=e&&e.send(R)},t.getSingleMessage=function(R,e,E){var O=R.split("_");2==O.length&&(R=O[1]),c({fromId:R,digest:e,msg:E},"onSingleMessage")},t.getErrorMessage=function(R,e){c({errId:R,errStr:e},"onErrorMessage")},t.getGroupMessage=function(R,e,E,O){var t=e.split("_");2==t.length&&(e=t[1]);var _=R.split("_");2==_.length&&(R=_[1]),c({groupId:R,fromId:e,digest:E,msg:O},"onGroupMessage")},t.getGroupPrivateMessage=function(R,e,E,O){var t=e.split("_");2==t.length&&(e=t[1]);var _=R.split("_");2==_.length&&(R=_[1]),c({groupId:R,fromId:e,digest:E,msg:O},"onGroupPrivateMessage")},t.getGroupPushMessage=function(R,e,E){var O=R.split("_");2==O.length&&(R=O[1]),c({groupId:R,digest:e,msg:E},"onGroupPushMessage")},t.getSystemPushMessage=function(R,e){c({digest:R,msg:e},"onSystemPushMessage")},t.startAuth=function(){StarRtc.AUtils.setUserInfo(_,a,s),t.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.V,StarRtc.AUtils.constructAuthMsg()))},window.onbeforeunload=function(){t.close()}},StarRtc.Instance=new function(){var t=this,n="",s="",c="",_=null,O=null,a=0;t.configModePulic=!0,t.loginServerUrl="ips2.starrtc.com",t.loginServerPort="9920",t.msgScheduleUrl="ips2.starrtc.com",t.msgSchedulePort="9904",t.chatRoomScheduleUrl="ips2.starrtc.com",t.chatRoomSchedulePort="9907",t.srcScheduleUrl="ips2.starrtc.com",t.srcSchedulePort="9929",t.vdnScheduleUrl="ips2.starrtc.com",t.vdnSchedulePort="9926",t.voipServerUrl="voip2.starrtc.com",t.voipServerPort="10086",t.voipServerWebsocketPort="10087",t.voipServerWebrtcPort="10088",t.workServerUrl="https://api.starrtc.com/public",t.webrtcServerIP="123.103.93.74",t.msgServerUrl="ips2.starrtc.com",t.msgServerWebsocketPort="9904",t.chatRoomServerUrl="ips2.starrtc.com",t.chatRoomServerWebsocketPort="9907",t.srcServerUrl="ips2.starrtc.com",t.srcServerWebsocketPort="9929",t.srcServerWebrtcPort="10088",t.vdnServerUrl="ips2.starrtc.com",t.vdnServerWebsocketPort="9929",t.vdnServerWebrtcPort="10088",t.version=function(){return StarRtc.StarManager.version()};var r=function(R,e){switch(e){case"connect failed":case"connect success":case"connect closed":_(R,e);break;case"onmessage":StarRtc.AUtils.parseProtocol(R,function(R){switch(R.appid){case APP_PRODUCT_ID.R:StarRtc.AUtils.parseMessage(R.msgArr)}});break;case"onSingleMessage":R.msg=JSON.parse(R.msg);var E=e;if(0==R.msg.type)switch(R.msg.code){case AG_MSG_VOIP_CTRL.h:R.type="voipCall",E="onVoipMessage";break;case AG_MSG_VOIP_CTRL.Y:R.type="voipRefuse",E="onVoipMessage";break;case AG_MSG_VOIP_CTRL.F:R.type="voipHangup",E="onVoipMessage";break;case AG_MSG_VOIP_CTRL.W:R.type="voipBusy",E="onVoipMessage";break;case AG_MSG_VOIP_CTRL.K:R.type="voipConnect",E="onVoipMessage";break;default:R.type="voipSingleMsg"}else R.type="voipSingleMsg";(null!=O?O:_)(R,E);break;case"onGroupMessage":case"onGroupPrivateMessage":case"onGroupPushMessage":case"onSystemPushMessage":case"onErrorMessage":null!=O&&O(R,e),_(R,e)}};t.setLoginServerUrl=function(R){t.loginServerUrl=R},t.setMsgScheduleUrl=function(R){t.msgScheduleUrl=R},t.setChatRoomScheduleUrl=function(R){t.chatRoomScheduleUrl=R},t.setSrcScheduleUrl=function(R){t.srcScheduleUrl=R},t.setVdnScheduleUrl=function(R){t.vdnScheduleUrl=R},t.setVoipServerUrl=function(R){t.voipServerUrl=R},t.setWorkServerUrl=function(R){t.workServerUrl=R},t.setWebrtcServerIP=function(R){t.webrtcServerIP=R},t.setMsgServerInfo=function(R,e){t.msgServerUrl=R,t.msgServerWebsocketPort=e},t.setchatRoomServerInfo=function(R,e){t.chatRoomServerUrl=R,t.chatRoomServerWebsocketPort=e},t.setSrcServerInfo=function(R,e,E){t.srcServerUrl=R,t.srcServerWebsocketPort=e,t.srcServerWebrtcPort=E},t.setVdnServerInfo=function(R,e,E){t.vdnServerUrl=R,t.vdnServerWebsocketPort=e,t.vdnServerWebrtcPort=E},t.setVoipServerInfo=function(R,e,E,O){t.voipServerUrl=R,t.voipServerPort=e,t.voipServerWebsocketPort=E,t.voipServerWebrtcPort=O},t.setConfigModePulic=function(R){t.configModePulic=R},t.login=function(R,e,E,O){(n=R)+"_"+(s=e),c=E,_=O,StarRtc.StarManager.login(R,e,E,r)},t.logout=function(){StarRtc.StarManager.close()},t.sendSingleMsg=function(R,e,E,O){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.V,StarRtc.AUtils.constructSingleMsg(R,++a,e,E,O)))},t.sendGroupMsg=function(R,e,E){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.V,StarRtc.AUtils.constructGroupMsg(R,++a,e,E)))},t.sendSingleCtrlMsg=function(R,e,E,O){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.V,StarRtc.AUtils.constructSingleCtrlMsg(R,++a,e,E,O)))},t.sendVoipCtrlMsg=function(R,e){var E="";e==AG_MSG_VOIP_CTRL.h&&(E=JSON.stringify({VoIP_protocal_type:"TCP",VoIP_server_IP:StarRtc.Instance.voipServerUrl,VoIP_server_Port:StarRtc.Instance.voipServerPort})),t.sendSingleCtrlMsg(R,"新消息",E,e)},t.sendVoipCallMsg=function(R){t.sendVoipCtrlMsg(R,AG_MSG_VOIP_CTRL.h)},t.sendVoipRefuseMsg=function(R){t.sendVoipCtrlMsg(R,AG_MSG_VOIP_CTRL.Y)},t.sendVoipHungupMsg=function(R){t.sendVoipCtrlMsg(R,AG_MSG_VOIP_CTRL.F)},t.sendVoipBusyMsg=function(R){t.sendVoipCtrlMsg(R,AG_MSG_VOIP_CTRL.W)},t.sendVoipConnectMsg=function(R){t.sendVoipCtrlMsg(R,AG_MSG_VOIP_CTRL.K)},t.setIMExtraback=function(R){O=R},t.getStarRoomSDK=function(R,e,E,O,t,_,a){var r=new StarRtc.StarRoomSDK(R,e,E,O,t,_,a);return r.login(n,s,c),r},t.getVideoMeetingRoomSDK=function(R,e,E){return t.getStarRoomSDK("src",R,e,E,3,1)},t.getVideoLiveRoomSDK=function(R,e,E,O){return t.getStarRoomSDK(R,e,E,O,3,2)},t.getVoipRoomSDK=function(R,e,E){return t.getStarRoomSDK("voip",R,e,E,2,0,t)}},StarRtc.WebrtcWebsocket=function(R,e){var E,O=this,t=e,_=R,a=null;return O.startHeartBeat=function(R){a.send(R),E=setInterval(function(){a.send(R)},5e3)},O.stopHeartBeat=function(){clearInterval(E)},O.connect=function(R){console.log("webrtcConnect"+R),(a=new WebSocket(R)).onerror=function(R){console.log("WebSocket连接发生错误"),_({msg:"WebSocket连接发生错误",data:R.data},"connect failed")},a.onopen=function(){console.log("WebSocket连接成功"),_({msg:"WebSocket连接成功"},"connect success")},a.onmessage=function(R){console.log("onmessage",R.data),_(R.data,"onmessage")},a.onclose=function(R){console.log("WebSocket连接关闭"),O.stopHeartBeat(),_({msg:"WebSocket连接关闭",data:R.code},"connect closed"),a=null}},O.starConnect=function(O){$.get(t,function(R,e){if(console.log("消息调度：",e,R),"success"===e){var E=JSON.parse(R);1==E.status?O("success",E.data):O("failed")}else O("failed")})},O.send=function(R){a.send(R)},O.close=function(){null!=a&&a.close()},O.readyState=function(){return null!=a?a.readyState:-1},O},StarRtc.StarRoomSDK=function(R,e,E,O,t,_,a){var r="我要上麦！",n=this,s="",c=e,S=R,i=O,N=E,I=t||3,A=0!=(1&I),o=0!=(2&I),V=null,M=null,C=null,P=null,T=!1,u=a;function L(R){if(null!=R){var e=R.getState();0<=e&&e<2&&R.sigDisconnect()}}function G(){var R=!0;return A&&(R=R&&(3==C.getState()||-1==C.getState())),o&&(R=R&&(3==V.getState()||-1==V.getState())),R}null!=u&&"voip"==R&&u.setIMExtraback(function(R,e){f(R,"onVoipMessage")});var f=function(R,e){switch(R.userData=i,R.obj=n,e){case"connect success":o?V.sigConnect():N(R,e,c);break;case"connect failed":case"connect closed":o&&L(V),G()&&N(R,e,c);break;case"onmessage":break;case"onChatRoomMessage":switch(R.type){case"createChatRoom":"success"==R.status&&(i.roomInfo.ID=R.chatroomId,i.roomInfo.Creator=s,o&&(M.roomInfo.Name=R.chatroomId,V.createNew()));break;case"deleteChatRoom":"success"==R.status&&(o?V.deleteCurrRoom():N(R,e,c));break;case"joinChatRoom":"success"==R.status&&o&&V.joinRoom();break;case"recvChatPrivateMsg":if(0==R.msg.type)switch(R.msg.code){case 2e3:R.msg.msgType="apply";break;case 2002:R.msg.msgType="applyAgree";break;case 2004:R.msg.msgType="applyDisagree";break;case 2200:R.msg.msgType="linkStop";break;case 2100:R.msg.msgType="invite";break;case 2102:R.msg.msgType="inviteAgree";break;case 2106:R.msg.msgType="inviteDisagree";break;case 2104:R.msg.msgType="inviteLinkStart";break;default:R.msg.msgType="common"}}N(R,e,c);break;case"onVoipMessage":switch(R.type){case"voipCall":u.sendVoipBusyMsg(R.fromId);break;case"voipHangup":R.fromId==i.roomInfo.targetId&&(n.leaveRoom(!0),N(R,e,c));break;case"voipBusy":n.leaveRoom(!0),N(R,e,c);break;case"voipRefuse":default:N(R,e,c)}}};return M=clone(i),P=clone(i),o&&A&&i.roomInfo.ID&&(M.roomInfo.ID=i.roomInfo.ID.substring(0,16),P.roomInfo.ID=i.roomInfo.ID.substring(16,33)),o&&(V=new StarRtc.StarVideoSDK(R,e,function(R,e){switch(R.userData=i,R.obj=n,e){case"connect success":N(R,e,c);break;case"connect closed":case"connect failed":A&&L(C),G()&&N(R,e,c);break;case"onmessage":break;case"onWebrtcMessage":switch(R.type){case"delChannel":"success"==R.status?N(R,e,c):alert("删除视频会议失败");break;case"createChannel":"success"==R.status&&(i.roomInfo.Creator=s,i.roomInfo.ID=A?R.channelId+i.roomInfo.ID:R.channelId),N(R,e,c);break;case"voipCallingAck":null!=u&&u.sendVoipCallMsg(i.roomInfo.targetId);break;case"voipResponseing":"success"==R.status&&null!=u&&u.sendVoipConnectMsg(i.roomInfo.targetId);break;default:N(R,e,c)}}},M,_)),A&&(C=new StarRtc.StarChatSDK(e,f,P)),n.login=function(R,e,E){R+"_"+(s=e),E,A&&C.login(R,e,E),o&&V.login(R,e,E)},n.sigConnect=function(){T=!1,A?C.sigConnect():o&&V.sigConnect()},n.sigDisconnect=function(R){null==R&&(R=!0),T=R,o?V.sigDisconnect():A&&C.sigDisconnect()},n.createNew=function(){"voip"!=S&&(A?C.createNew():o&&V.createNew())},n.deleteCurrRoom=function(){"voip"!=S&&(A?C.deleteCurrRoom():o&&V.deleteCurrRoom())},n.createStream=function(R){o&&V.createStream(R)},n.joinRoom=function(){A&&"new"!=c?C.joinRoom():o&&V.joinRoom()},n.leaveRoom=function(R){if(o){switch(S){case"voip":var e=R||!1;null==u||e||u.sendVoipHungupMsg(i.roomInfo.targetId),u.setIMExtraback(null)}V.leaveRoom(e)}else A&&C.leaveRoom()},n.streamConfigChange=function(R){o&&V.streamConfigChange(R)},n.sendChatMsg=function(R){A&&C.sendChatMsg(R)},n.sendVoipMsg=function(R){"voip"==S&&null!=u&&u.sendSingleMsg(i.roomInfo.targetId,"新媒体",R)},n.sendChatPrivateMsg=function(R,e){A&&C.sendChatPrivateMsg(R,e)},n.sendApplyMsg=function(){A&&o&&"vdn"==S&&C.sendChatCtrlPrivateMsg(i.roomInfo.Creator,r,2e3)},n.sendApplyAgreeMsg=function(R){A&&o&&"src"==S&&C.sendChatCtrlPrivateMsg(R,r,2002)},n.sendApplyDisagreeMsg=function(R){A&&o&&"src"==S&&C.sendChatCtrlPrivateMsg(R,r,2004)},n.sendInviteLinkMsg=function(R){A&&o&&"src"==S&&C.sendChatCtrlPrivateMsg(R,r,2100)},n.sendInviteLinkAgreeMsg=function(){A&&o&&"vdn"==S&&C.sendChatCtrlPrivateMsg(i.roomInfo.Creator,r,2102)},n.sendInviteLinkDisagreeMsg=function(){A&&o&&"vdn"==S&&C.sendChatCtrlPrivateMsg(i.roomInfo.Creator,r,2106)},n.sendInviteLinkStartMsg=function(){A&&o&&"vdn"==S&&C.sendChatCtrlPrivateMsg(i.roomInfo.Creator,r,2104)},n.sendLinkStopMsg=function(R){A&&o&&"src"==S&&C.sendChatCtrlPrivateMsg(R,r,2200)},n.kickOutUser=function(R){A&&C.kickOutUser(R)},n.banToSendMsg=function(R,e){A&&C.banToSendMsg(R,e)},n.getRoomOnlineNum=function(){A&&C.getRoomOnlineNum()},n.sendStreamData=function(R){o&&"src"==S&&V.sendStreamData(R)},n.activeDisconnect=function(){return T},n},StarRtc.StarVideoSDK=function(R,e,E,O,t){var n,s,c=this,S="",i="",N=O,I=R,A=E,o=e,V=null,M="",C={},P={},_=t||1,T={siv:0,uperInfos:{}},u=StarWebRTC();u.init();var L=!1,a=!1,r=function(R){switch(R.type){case"createOffer":if("success"==R.status){switch(I){case"src":R.channelId=N.roomInfo.ID;break;case"vdn":R.ssrc=R.bigVideoSSRC;break;case"voip":R.targetId=N.roomInfo.targetId,R.videoSSRC=R.bigVideoSSRC}c.joinRoomInternal(R)}break;case"applyAnswer":R.status}},G=function(R,e){var E={type:"streamCreated",streamObj:e};E.userData=N,E.obj=c,E.status="success"==R?"success":"failed",A(E,"onWebrtcMessage",o)},f=function(R,e){switch(R.userData=N,R.obj=c,e){case"connect success":var E=null;switch(I){case"src":E=StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.P,StarRtc.AUtils.constructHeartBeatMsg(AG_LIVESRCMOONSERVER.bE));break;case"vdn":E=StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.N,ACTION_GROUP_ID.P,StarRtc.AUtils.constructHeartBeatMsg(AG_LIVEVDNMOONSERVER.NO))}V.startHeartBeat(E),u.setServerInfo({serverIp:C.ip,serverPort:C.webrtcPort}),A(R,e,o);break;case"connect failed":case"connect closed":u.destroy(),V=null,A(R,e,o);break;case"onmessage":StarRtc.AUtils.parseProtocol(R,function(R){R.appid==APP_PRODUCT_ID.i?StarRtc.AUtils.parseSrcMoonServerMessage(R.msgArr,function(R){f(R,"onWebrtcMessage")}):R.appid==APP_PRODUCT_ID.N?StarRtc.AUtils.parseVdnMoonServerMessage(R.msgArr,function(R){f(R,"onWebrtcMessage")}):R.appid==APP_PRODUCT_ID.I&&StarRtc.AUtils.parseVoipMoonServerMessage(R.msgArr,function(R){f(R,"onWebrtcMessage")})});break;case"onWebrtcMessage":switch(R.type){case"uperStreamInfoUpdate":if("success"==R.status){if(L)for(var O=0;O<7;++O){var t=u.getStreamByIndex(O),_=void 0;0!=Object.keys(T.uperInfos).length&&(_=T.uperInfos[O]);var a=R.msg.uperInfos[O];if(null==_&&null!=a)a.userId!=i&&A({type:"addUploader",upId:a.upId,upUserId:a.userId,streamInfo:t,room:c},e,o);else if(null!=_&&null==a){var r=s==_.upId;r&&(s=n=void 0),u.resetStreamInfo(t),A({type:"removeUploader",upId:_.upId,upUserId:_.userId,streamInfo:t,bigFlag:r,room:c},e,o)}else null!=_&&null!=a&&_.userId!=a.userId&&A({type:"changeUploader",upId:a.upId,oldUpUserId:_.userId,newUpUserId:a.userId,streamInfo:t,room:c},e,o)}T=R.msg}break;case"vdnWebrtcReg":if("success"==R.status)switch(I){case"vdn":M=R.fingerprint,V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.N,ACTION_GROUP_ID.P,StarRtc.AUtils.constructVdnProtocol(AG_LIVEVDNMOONSERVER.SO,{channelId:N.roomInfo.ID})))}else console.log("vdnWebrtcReg failed");break;case"vdnApplyDownload":"success"==R.status?u.emit("_webrtc_apply_ok",M,function(){L=!0,f({type:"uperStreamInfoUpdate",status:"success",msg:R.uperInfos},"onWebrtcMessage")}):console.log("收到vdnApplyDownload failed"),A(R,e,o);break;case"srcApplyUpload":"success"==R.status?(R.tmpData=P,console.log("收到_webrtc_apply_ok"),u.emit("_webrtc_apply_ok",R.fingerprint,function(){L=!0;var R=clone(T);T.uperInfos={},f({type:"uperStreamInfoUpdate",status:"success",msg:R},"onWebrtcMessage")})):console.log("收到srcApplyUpload failed"),A(R,e,o);break;case"streamConfig":if("success"==R.status){if(n==s){t=u.getStreamByIndex(n);u.switchStreamInfo(t);break}if(null!=n){t=u.getStreamByIndex(n);u.switchStreamInfo(t)}if(null!=s){t=u.getStreamByIndex(s);u.switchStreamInfo(t)}}break;case"createChannel":"success"==R.status&&(N.roomInfo.ID=R.channelId,N.roomInfo.Creator=S),A(R,e,o);break;case"delChannel":"success"==R.status&&(N.roomInfo.ID=""),A(R,e,o);break;case"serverErr":break;case"voipResponseing":case"voipCalling":"success"==R.status&&(console.log("收到_webrtc_apply_ok"),u.emit("_webrtc_apply_ok",R.fingerprint,function(){f({type:"voipStreamReady",status:"success"},"onWebrtcMessage")})),A(R,e,o);break;case"voipStreamReady":t=u.getStreamByIndex(0);u.switchStreamInfo(t),A({type:"voipStreamReady",streamObj:t.streamObj,room:c},e,o);break;default:A(R,e,o)}}};return c.login=function(R,e,E){i=R+"_"+(S=e),E},c.sigConnect=function(){switch(a=!1,C.ip=StarRtc.Instance.webrtcServerIP,V=null,I){case"src":if(!StarRtc.Instance.configModePulic){V=new StarRtc.WebrtcWebsocket(f,null),(E={}).ip=StarRtc.Instance.srcServerUrl,C.websocketPort=StarRtc.Instance.srcServerWebsocketPort,C.webrtcPort=StarRtc.Instance.srcServerWebrtcPort,E.websocketPort=C.websocketPort;var R="wss://"+E.ip+":"+E.websocketPort;return void V.connect(R)}var e="https://"+StarRtc.Instance.srcScheduleUrl+":"+StarRtc.Instance.srcSchedulePort+"?userId="+i;V=new StarRtc.WebrtcWebsocket(f,e);break;case"vdn":if(!StarRtc.Instance.configModePulic){V=new StarRtc.WebrtcWebsocket(f,null),(E={}).ip=StarRtc.Instance.vdnServerUrl,C.websocketPort=StarRtc.Instance.vdnServerWebsocketPort,C.webrtcPort=StarRtc.Instance.vdnServerWebrtcPort,E.websocketPort=C.websocketPort;R="wss://"+E.ip+":"+E.websocketPort;return void V.connect(R)}e="https://"+StarRtc.Instance.vdnScheduleUrl+":"+StarRtc.Instance.vdnSchedulePort+"?userId="+i+"&channelId="+N.channelId;V=new StarRtc.WebrtcWebsocket(f,e);break;case"voip":var E;V=new StarRtc.WebrtcWebsocket(f,null),(E={}).ip=StarRtc.Instance.voipServerUrl,C.websocketPort=StarRtc.Instance.voipServerWebsocketPort,C.webrtcPort=StarRtc.Instance.voipServerWebrtcPort,E.websocketPort=C.websocketPort;R="wss://"+E.ip+":"+E.websocketPort;return void V.connect(R);default:return}V.starConnect(function(R,e){if("success"==R){C.websocketPort=e.websocketPort,C.webrtcPort=e.webrtcPort;var E="wss://"+e.ip+":"+e.websocketPort;V.connect(E)}})},c.sigDisconnect=function(R){null==R&&(R=!0),a=R,null!=V&&(V.close(),V=null)},c.createNew=function(){if(null!=V)switch(I){case"src":var R="1";2==_&&(R="2");var e=AG_LIVESRCMOONSERVER.oE;V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.P,StarRtc.AUtils.constructSrcProtocol(e,{conCurrentNum:7,roomId:N.roomInfo.Name,extra:R,liveType:parseInt(R)})))}},c.deleteCurrRoom=function(){if(null!=V)switch(I){case"src":V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.P,StarRtc.AUtils.constructSrcProtocol(AG_LIVESRCMOONSERVER.pE,{channelId:N.roomInfo.ID})))}},c.createStream=function(R){null==R&&(R={video:{width:{ideal:640},height:{ideal:480},frameRate:{ideal:25},facingMode:{ideal:["user"]}},audio:{deviceId:{ideal:["default"]}}}),u.createStream(R,G)},c.joinRoom=function(){u.emit("ready",r,"voip"==I)},c.joinRoomInternal=function(R){switch(P=R,I){case"src":V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.P,StarRtc.AUtils.constructWebrtcUploadMsgProtocol(R)));break;case"vdn":V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.N,ACTION_GROUP_ID.P,StarRtc.AUtils.constructVdnProtocol(AG_LIVEVDNMOONSERVER.cO,R)));break;case"voip":"call"==o?V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.I,ACTION_GROUP_ID.T,StarRtc.AUtils.constructVOIPProtocol(AG_VOIPMOONSERVER.Ve,R))):"response"==o&&V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.I,ACTION_GROUP_ID.T,StarRtc.AUtils.constructVOIPProtocol(AG_VOIPMOONSERVER.Ce,R)))}},c.leaveRoom=function(R){if(null!=V&&1==V.readyState())switch(I){case"src":V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.P,StarRtc.AUtils.constructSrcProtocol(AG_LIVESRCMOONSERVER.DE,{channelId:N.roomInfo.ID})));break;case"vdn":V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.N,ACTION_GROUP_ID.P,StarRtc.AUtils.constructVdnProtocol(AG_LIVEVDNMOONSERVER.iO,{})));case"voip":V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.I,ACTION_GROUP_ID.T,StarRtc.AUtils.constructVOIPProtocol(AG_VOIPMOONSERVER.ue,{isActive:R?0:1})))}},c.streamConfigChange=function(R){if(null!=V){s==R?(s=n,n=R):(n=s,s=R);var e=u.getStreamInfos(),E=[];for(var O in e){var t=0;t=n==s?e[O].switchFlag?1:2:O==n?1:O==s?2:e[O].switchFlag?2:1,E.push(t)}switch(I){case"src":V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.P,StarRtc.AUtils.constructSrcProtocol(AG_LIVESRCMOONSERVER.UE,{streamConfig:E})));break;case"vdn":V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.N,ACTION_GROUP_ID.P,StarRtc.AUtils.constructVdnProtocol(AG_LIVEVDNMOONSERVER.AO,{streamConfig:E})))}}},c.getState=function(){return null!=V?V.readyState():-1},c.getType=function(){return I},c.sendStreamData=function(R){switch(I){case"src":V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.P,StarRtc.AUtils.constructSrcProtocol(AG_LIVESRCMOONSERVER.dE,{streamData:R,streamDataType:8})))}},c.activeDisconnect=function(){return a},c},StarRtc.StarChatSDK=function(R,e,E){var O=this,t="",_="",a={},r=E,n=e,s=R,c=null,S=0,i=!1,N=function(R,e){switch(R.userData=r,R.obj=O,e){case"connect success":var E;E=StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.M,StarRtc.AUtils.constructHeartBeatMsg(AG_CHATROOMMOONSERVER.mR)),c.startHeartBeat(E),n(R,e,s);break;case"connect failed":case"connect closed":c=null,n(R,e,s);break;case"onmessage":StarRtc.AUtils.parseProtocol(R,function(R){R.appid==APP_PRODUCT_ID.O&&StarRtc.AUtils.parseChatMoonServerMessage(R.msgArr,function(R){N(R,"onChatRoomMessage")})});break;case"onChatRoomMessage":switch(R.type){case"createChatRoom":"success"==R.status&&(r.roomInfo.ID=R.chatroomId,r.roomInfo.Creator=t);break;case"deleteChatRoom":case"joinChatRoom":R.status;break;case"recvChatPrivateMsg":case"recvChatMsg":if(""==R.fromUserId||""==R.msg)return;if(R.msg=JSON.parse(R.msg),R.msg.fromId==t)return}n(R,e,s)}};return O.login=function(R,e,E){_=R+"_"+(t=e),E},O.sigConnect=function(){if(i=!1,StarRtc.Instance.configModePulic){var R="https://"+StarRtc.Instance.chatRoomScheduleUrl+":"+StarRtc.Instance.chatRoomSchedulePort+"/?userId="+_;(c=new StarRtc.WebrtcWebsocket(N,R)).starConnect(function(R,e){if("success"==R){var E=e.split(":");a.ip=E[0],a.port=E[1];var O="wss://"+a.ip+":"+a.port;c.connect(O)}})}else{c=new StarRtc.WebrtcWebsocket(N,null),a.ip=StarRtc.Instance.chatRoomServerUrl,a.port=StarRtc.Instance.chatRoomServerWebsocketPort;var e="wss://"+a.ip+":"+a.port;c.connect(e)}},O.sigDisconnect=function(R){null==R&&(R=!0),i=R,null!=c&&(c.close(),c=null)},O.createNew=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.M,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.dR,{roomType:0==r.roomInfo.Type?1:2,conCurrentNum:100,userDefineData:r.roomInfo.Name})))},O.sendChatMsg=function(R){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.M,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.hR,{roomId:r.roomInfo.ID,digest:"新消息",msgIndex:++S,msg:R})))},O.sendChatPrivateMsg=function(R,e){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.M,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.YR,{toUserId:R,roomId:r.roomInfo.ID,digest:"新消息",msgIndex:++S,msg:e,type:"1",code:"0"})))},O.sendChatCtrlPrivateMsg=function(R,e,E){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.M,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.YR,{toUserId:R,roomId:r.roomInfo.ID,digest:"新消息",msgIndex:++S,msg:e,type:"0",code:E})))},O.kickOutUser=function(R){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.M,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.kR,{kickOutUserId:R})))},O.banToSendMsg=function(R,e){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.M,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.HR,{banUserId:R,banTime:e})))},O.getRoomOnlineNum=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.M,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.xR,{roomId:r.roomInfo.ID})))},O.deleteCurrRoom=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.M,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.bR)))},O.joinRoom=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.M,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.gR,{roomId:r.roomInfo.ID})))},O.leaveRoom=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.M,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.wR)))},O.getState=function(){return null!=c?c.readyState():-1},O.activeDisconnect=function(){return i},O};